#!/bin/bash

selected_packages=$(
  apt-cache pkgnames |
    fzf -m --ansi --prompt="Enter Package Names: " \
      --preview "nala show --color {} 2>/dev/null" \
      --preview-window 'top:75%' \
      --bind 'ctrl-a:select-all' \
      --bind 'ctrl-d:deselect-all'
)

if [[ -n "$selected_packages" ]]; then
  # For installation: space-separated
  package=$(echo "$selected_packages" | tr "\n" " " | sed 's/ $//')
  
  # For display: comma+space separated
  # Replace newlines with comma+space, remove trailing comma+space if exists
  package_display=$(echo "$selected_packages" | tr "\n" "," | sed 's/,$//; s/,/, /g')
  
  # Count packages
  package_count=$(echo "$selected_packages" | wc -l)
  
  echo -e "\nSelected $package_count package(s): \033[1;32m$package_display\033[0m"
  read -n1 -p "Install? [y/N]: " install
  echo
  if [[ "$install" == "y" ]] || [[ "$install" == "Y" ]]; then
    sudo nala install $package
  else
    echo "Installation cancelled."
  fi
else
  echo "No packages selected."
fi
